# README

This server hosts a `neperf` server.
To minimize unnecesary traffic, the `netserver` process uses
a passphrase set with the `-Z` option.

That `passphrase` is created by the _update\_passphrase.sh_
script that is initiated by a job that runs at
one minute after midnight.
The script stops any `netserver` instances,
generates a new passphrase,
writes that passphrase into _/home/netperf/passphrase.txt_,
then restarts with `netserver -Z new-passphrase`

The cron job that does this is 
and it is invoked with this `crontab -e` entry:

```
1 0 * * * /bin/bash /home/netperf/update_passphrase.sh
```

People learn the current passphrase by coming to the site: [https://netperf.bufferbloat.net](https://netperf.bufferbloat.net).
The main page displays the current passphrase in a page
generated by a PHP script that returns the contents of
the _index.md_ file, substituting the current passphrase
(in _passphrase.txt_) for `{passphrase}` in the .md.

The _update\_passphrase.sh_ script can be run at any time.
It updates the `-Z` passphrase used by `netserver`,
and the _passphrase.txt_ shown in the web page.

## Configuration

This site runs as a virtual host on atl.richb-hanover.com.
The VirtualHost config file sets the DocumentRoot to _/home/netperf/Netperf-with-passphrase_. 

## Deploying

To deploy this site after all the permissions are in place,
log in as `deploy` and use these steps to:

1. Create a copy of the repo in the `deploy` home directory
2. Copy all the files to the _/home/netperf/_ directory to be used in production.

```
# One time
cd && git clone https://github.com/richb-hanover/Netperf-with-passphrase.git
# This saves the repo in /home/deploy/Netperf-with-passphrase

# To re-deploy after changes
cd Netperf-with-passphrase
git pull
sudo cp -r * /home/netperf/Netperf-with-passphrase/
```

