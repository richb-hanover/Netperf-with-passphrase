# README

This server hosts a `neperf` server.
To minimize unnecesary traffic, the `netserver` process uses
a passphrase set with the `-Z` option.

That `passphrase` is created by the _update\_passphrase.sh_
script that is initiated by a job that runs at
one minute after midnight.
The script stops any `netserver` instances,
generates a new passphrase,
writes that passphrase into _/home/netperf/passphrase.txt_,
then restarts with `netserver -Z new-passphrase`

The cron job that does this is 
and it is invoked with this `crontab -e` entry:

```
1 0 * * * /bin/bash /home/netperf/update_passphrase.sh
```

People learn the current passphrase by coming to ths site:
[https://netperf.bufferbloat.net](https://netperf.bufferbloat.net).
The main page displays the current passphrase in a page
generated by a PHP script that returns the contents of
the _index.md_ file, substituting the current passphrase
(in _passphrase.txt_) for `{passphrase}` in the .md.

The _update\_passphrase.sh_ script can be run at any time.
It updates the `-Z` passphrase used by `netserver`,
and the _passphrase.txt_ in the local directory.

## Configuration

This site runs as a virtual host on atl.richb-hanover.com.
The VirtualHost config file sets the DocumentRoot to _/home/netperf/public_html_. 

## Testing

Test the page locally using `php -S localhost:8000`

## Deploying

To deploy this site after all the permissions are in place,
log in as `deploy` and use `sudo deploy.sh`.

This re-runs the _update\_passphrase.sh_ script, 
then copies the files to the _/home/netperf/public\_html_ directory.


